clear all

pathname = 'C:\Users\emackev\Dropbox (MIT)\Wavelets-tSNE\damd1\'
DIR = dir(pathname)
folder = '02-01-55'; '02-02-2'; 
%'02-01-55' is song locked
% 01-28-2070 has lots of stim artifacts
%'01-29-2070' is not locked to onsets, but 1:124 could be interesting to look at.
%'01-31-238' is not locked to onsets, could be interesting, need to figure
%out what's going on with weird duration distributions (sometimes high
%firing rate and step/slant in disturbution, associated with long files it
%looks like)
% '02-01-148' only 43 files
% 02-01-233' only 24 files
% 02-01-289 not particularly locked, but nice data quality
% '02-02-2' pretty locked to gaps, stephane thinks


load(fullfile(pathname, folder, 'firing.mat')); 
load(fullfile(pathname, folder, 'dbase.mat')); 

Alldurs = []; 
AllSpiketimesX = []; 
AllSpiketimesY = []; 
figure(1); clf
segID = 1; 
for filei = [10:13] 
    filei
    %%%spk{filei} = dbase.SegmentTimes{filei}(:)'; 
    figure(1); clf; hold on
    b=sprintf('%6.6d',filei);
    [sound2,fs] = wavread(fullfile(pathname, folder, ['sound' b '.wav']));
    dt = 1/fs';
    plot(dt:dt:(dt*length(sound2)),sound2)
    displaySpecgramQuick(sound2,fs)
    sound(sound2/max(abs(sound2)),fs)
    plot(spk{filei}*dt, .001*ones(size(spk{filei})),'r.', 'markersize', 20)
    for segi = 1:length(dbase.IsSelected{filei})
        if dbase.IsSelected{filei}(segi)
            plot(dbase.SegmentTimes{filei}(segi,:)*dt, 7500*[1 1], 'w', 'linewidth', 3); 
            Alldurs = [Alldurs diff(dbase.SegmentTimes{filei}(segi,:))*dt*ones(1,length(spk{filei}))];
            segID = segID + 1; 
            AllSpiketimesY = [AllSpiketimesY segID*ones(1,length(spk{filei}))];           
            AllSpiketimesX = [AllSpiketimesX spk{filei}*dt - dbase.SegmentTimes{filei}(segi,1)*dt];
        end
    end
    
    shg; pause(.5)
end

[~,ind] = sort(Alldurs); 
[~,ind2] = sort(ind); 
%ind = 1:length(Alldurs); 
%
figure
hold on
plot(AllSpiketimesX, AllSpiketimesY(ind2), 'k.')
plot(Alldurs, AllSpiketimesY(ind2), 'r.')
xlim([-.3 .5])